<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend Portal Home para Calificaciones -->
    <template id="portal_my_home_grades" inherit_id="portal.portal_my_home" name="Portal My Home : Grades">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="after">
            <div class="mt-4" style="max-width: 400px;">
                <a href="/my/grades" class="text-decoration-none">
                    <div class="p-3" style="background-color: #f8f9fa; border-radius: 8px;">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fa fa-graduation-cap text-muted" style="font-size: 1.75rem;"></i>
                            </div>
                            <div>
                                <div class="text-dark mb-0" style="font-size: 1rem; font-weight: 500;">Calificaciones</div>
                                <div class="text-muted" style="font-size: 0.875rem;">Ver historial de calificaciones</div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </xpath>
    </template>

    <!-- Grades List Template -->
    <template id="portal_my_grades" name="Grades">
        <t t-call="portal.portal_layout">
            <div class="o_portal_my_home">
                <div class="container">
                    <!-- Breadcrumb -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <ol class="breadcrumb o_portal_submenu">
                                <li class="breadcrumb-item">
                                    <a href="/my/home">Home</a>
                                </li>
                                <li class="breadcrumb-item active">Calificaciones</li>
                            </ol>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h3>Historial de Calificaciones</h3>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card o_portal_card mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-striped mb-0">
                                            <thead>
                                                <tr class="table-light">
                                                    <th>Asignatura</th>
                                                    <th>Profesor</th>
                                                    <th>Fecha</th>
                                                    <th class="text-end">Calificación</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-if="not grades">
                                                    <tr>
                                                        <td colspan="4" class="text-center text-muted">
                                                            <div class="p-4">
                                                                No hay calificaciones disponibles aún.
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </t>
                                                <t t-foreach="grades" t-as="grade">
                                                    <tr>
                                                        <td><span t-field="grade.enrollment_id.subject_id.name"/></td>
                                                        <td><span t-field="grade.enrollment_id.teacher_id.name"/></td>
                                                        <td><span t-field="grade.date" t-options='{"format": "dd/MM/yyyy"}'/></td>
                                                        <td class="text-end">
                                                            <span t-field="grade.value" 
                                                                t-options='{"widget": "float", "precision": 2}'
                                                                t-attf-class="badge {{ 'bg-success' if grade.value >= 7 else ('bg-warning' if grade.value >= 5 else 'bg-danger') }}"/>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>